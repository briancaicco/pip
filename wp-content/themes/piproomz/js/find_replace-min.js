/**
 * findAndReplaceDOMText v 0.4.0
 * @author James Padolsey http://james.padolsey.com
 * @license http://unlicense.org/UNLICENSE
 *
 * Matches the text of a DOM node against a regular expression
 * and replaces each match (or node-separated portions of the match)
 * in the specified element.
 */
window.findAndReplaceDOMText=function(){function e(e){return"[object Array]"==p.call(e)}function n(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function t(){return r.apply(null,arguments)||i.apply(null,arguments)}function r(e,n,r,d,o){if(n&&!n.nodeType&&arguments.length<=2)return!1;var a="function"==typeof r;a&&(r=function(e){return function(n,t){return e(n.text,t.startIndex)}}(r));var s=i(n,{find:e,wrap:a?null:r,replace:a?r:"$"+(d||"&"),prepMatch:function(e,n){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(d>0){var t=e[d];e.index+=e[0].indexOf(t),e[0]=t}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=n,e},filterElements:o});return t.revert=function(){return s.revert()},!0}function i(e,n){return new d(e,n)}function d(e,n){n.portionMode=n.portionMode||o,this.node=e,this.options=n,this.prepMatch=n.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var o="retain",a="first",s=document,p={}.toString;return t.Finder=d,d.prototype={search:function(){var e,t=0,r=this.options.find,i=this.getAggregateText(),d=[];if(r="string"==typeof r?RegExp(n(r),"g"):r,r.global)for(;e=r.exec(i);)d.push(this.prepMatch(e,t++));else(e=i.match(r))&&d.push(this.prepMatch(e,0));return d},prepMatch:function(e,n){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=n,e},getAggregateText:function(){function e(t){if(3===t.nodeType)return t.data;if(n&&!n(t))return"";var r="";if(t=t.firstChild)do{r+=e(t)}while(t=t.nextSibling);return r}var n=this.options.filterElements;return e(this.node)},processMatches:function(){var e=this.matches,n=this.node,t=this.options.filterElements,r,i,d=[],o=n,a=e.shift(),s=0,p=0,h=0,c;e:for(;;){if(3===o.nodeType&&(!i&&o.length+s>=a.endIndex?i={node:o,index:h++,text:o.data.substring(a.startIndex-s,a.endIndex-s),indexInMatch:s-a.startIndex,indexInNode:a.startIndex-s,endIndexInNode:a.endIndex-s,isEnd:!0}:r&&d.push({node:o,index:h++,text:o.data,indexInMatch:s-a.startIndex,indexInNode:0}),!r&&o.length+s>a.startIndex&&(r={node:o,index:h++,indexInMatch:0,indexInNode:a.startIndex-s,endIndexInNode:a.endIndex-s,text:o.data.substring(a.startIndex-s,a.endIndex-s)}),s+=o.data.length),c=1===o.nodeType&&t&&!t(o),r&&i){if(o=this.replaceMatch(a,r,d,i),s-=i.node.data.length-i.endIndexInNode,r=null,i=null,d=[],a=e.shift(),h=0,p++,!a)break}else if(!c&&(o.firstChild||o.nextSibling)){o=o.firstChild||o.nextSibling;continue}for(;;){if(o.nextSibling){o=o.nextSibling;break}if(o.parentNode===n)break e;o=o.parentNode}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,n,t,r){var i=this.options.portionMode;return"first"===i&&n.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,function(e,n){var r;switch(n){case"&":r=t[0];break;case"`":r=t.input.substring(0,t.startIndex);break;case"'":r=t.input.substring(t.endIndex);break;default:r=t[+n]}return r}),"first"===i?e:n.isEnd?e.substring(n.indexInMatch):e.substring(n.indexInMatch,n.indexInMatch+n.text.length))},getPortionReplacementNode:function(e,n,t){var r=this.options.replace||"$&",i=this.options.wrap;if(i&&i.nodeType){var d=s.createElement("div");d.innerHTML=i.outerHTML||(new XMLSerializer).serializeToString(i),i=d.firstChild}if("function"==typeof r)return r=r(e,n,t),r&&r.nodeType?r:s.createTextNode(String(r));var o="string"==typeof i?s.createElement(i):i;return r=s.createTextNode(this.prepareReplacementString(r,e,n,t)),o?(o.appendChild(r),o):r},replaceMatch:function(e,n,t,r){var i=n.node,d=r.node,o,a;if(i===d){var p=i;n.indexInNode>0&&(o=s.createTextNode(p.data.substring(0,n.indexInNode)),p.parentNode.insertBefore(o,p));var h=this.getPortionReplacementNode(r,e);return p.parentNode.insertBefore(h,p),r.endIndexInNode<p.length&&(a=s.createTextNode(p.data.substring(r.endIndexInNode)),p.parentNode.insertBefore(a,p)),p.parentNode.removeChild(p),this.reverts.push(function(){o===h.previousSibling&&o.parentNode.removeChild(o),a===h.nextSibling&&a.parentNode.removeChild(a),h.parentNode.replaceChild(p,h)}),h}o=s.createTextNode(i.data.substring(0,n.indexInNode)),a=s.createTextNode(d.data.substring(r.endIndexInNode));for(var c=this.getPortionReplacementNode(n,e),l=[],u=0,f=t.length;u<f;++u){var x=t[u],g=this.getPortionReplacementNode(x,e);x.node.parentNode.replaceChild(g,x.node),this.reverts.push(function(e,n){return function(){n.parentNode.replaceChild(e.node,n)}}(x,g)),l.push(g)}var I=this.getPortionReplacementNode(r,e);return i.parentNode.insertBefore(o,i),i.parentNode.insertBefore(c,i),i.parentNode.removeChild(i),d.parentNode.insertBefore(I,d),d.parentNode.insertBefore(a,d),d.parentNode.removeChild(d),this.reverts.push(function(){o.parentNode.removeChild(o),c.parentNode.replaceChild(i,c),a.parentNode.removeChild(a),I.parentNode.replaceChild(d,I)}),I}},t}(),findAndReplaceDOMText(/group/g,document.body,function(e,n){var t=document.createElement("span");return t.style.backgroundColor="red",t.innerHTML=e,t});